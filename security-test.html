<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Seguran√ßa - EXE BOTS</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #fff;
            padding: 2rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: #00ff88;
            font-size: 2.5rem;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .test-section h2 {
            color: #00d4ff;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .test-button {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            color: #0a0e27;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .test-result {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            color: #00ff88;
        }

        .error {
            color: #ff0080;
        }

        .warning {
            color: #ffc107;
        }

        .info {
            color: #00d4ff;
        }

        input {
            width: 100%;
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }

        input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: rgba(0, 255, 136, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí TESTE DE SEGURAN√áA - EXE BOTS</h1>

        <!-- Estat√≠sticas -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalTests">0</div>
                <div class="stat-label">Testes Executados</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">Testes Aprovados</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="failedTests">0</div>
                <div class="stat-label">Testes Falhados</div>
            </div>
        </div>

        <!-- Teste 1: XSS Protection -->
        <div class="test-section">
            <h2>1. Teste de Prote√ß√£o XSS</h2>
            <p>Digite um script malicioso para testar a prote√ß√£o:</p>
            <input type="text" id="xssInput" placeholder="Ex: <script>alert('XSS')</script>">
            <button class="test-button" onclick="testXSS()">Testar XSS</button>
            <div class="test-result" id="xssResult"></div>
        </div>

        <!-- Teste 2: Email Validation -->
        <div class="test-section">
            <h2>2. Teste de Valida√ß√£o de Email</h2>
            <p>Digite um email para validar:</p>
            <input type="text" id="emailInput" placeholder="Ex: usuario@exemplo.com">
            <button class="test-button" onclick="testEmail()">Validar Email</button>
            <div class="test-result" id="emailResult"></div>
        </div>

        <!-- Teste 3: Password Strength -->
        <div class="test-section">
            <h2>3. Teste de For√ßa da Senha</h2>
            <p>Digite uma senha para verificar sua for√ßa:</p>
            <input type="password" id="passwordInput" placeholder="Digite sua senha">
            <button class="test-button" onclick="testPassword()">Verificar Senha</button>
            <div class="test-result" id="passwordResult"></div>
        </div>

        <!-- Teste 4: Rate Limiting -->
        <div class="test-section">
            <h2>4. Teste de Rate Limiting</h2>
            <p>Clique m√∫ltiplas vezes para testar o bloqueio:</p>
            <button class="test-button" onclick="testRateLimit()">Simular Tentativa</button>
            <button class="test-button" onclick="resetRateLimit()">Resetar Contador</button>
            <div class="test-result" id="rateLimitResult"></div>
        </div>

        <!-- Teste 5: Encryption -->
        <div class="test-section">
            <h2>5. Teste de Criptografia</h2>
            <p>Digite um texto para criptografar:</p>
            <input type="text" id="encryptInput" placeholder="Digite um texto">
            <button class="test-button" onclick="testEncryption()">Criptografar</button>
            <button class="test-button" onclick="testDecryption()">Descriptografar</button>
            <div class="test-result" id="encryptResult"></div>
        </div>

        <!-- Teste 6: Security Logs -->
        <div class="test-section">
            <h2>6. Logs de Seguran√ßa</h2>
            <button class="test-button" onclick="viewLogs()">Ver Logs</button>
            <button class="test-button" onclick="clearLogs()">Limpar Logs</button>
            <div class="test-result" id="logsResult"></div>
        </div>

        <!-- Teste 7: Session Management -->
        <div class="test-section">
            <h2>7. Gerenciamento de Sess√£o</h2>
            <button class="test-button" onclick="checkSession()">Verificar Sess√£o</button>
            <button class="test-button" onclick="createSession()">Criar Sess√£o</button>
            <button class="test-button" onclick="destroySession()">Destruir Sess√£o</button>
            <div class="test-result" id="sessionResult"></div>
        </div>

        <!-- Teste Completo -->
        <div class="test-section">
            <h2>üöÄ Executar Todos os Testes</h2>
            <button class="test-button" onclick="runAllTests()">Executar Tudo</button>
            <div class="test-result" id="allTestsResult"></div>
        </div>
    </div>

    <script src="security.js"></script>
    <script>
        let stats = { total: 0, passed: 0, failed: 0 };
        let encryptedData = null;

        // Atualizar estat√≠sticas
        function updateStats() {
            document.getElementById('totalTests').textContent = stats.total;
            document.getElementById('passedTests').textContent = stats.passed;
            document.getElementById('failedTests').textContent = stats.failed;
        }

        // Teste 1: XSS
        function testXSS() {
            const input = document.getElementById('xssInput').value;
            const result = document.getElementById('xssResult');
            
            const detected = XSSProtection.detectXSS(input);
            const cleaned = XSSProtection.cleanXSS(input);
            
            stats.total++;
            if (detected || input !== cleaned) {
                stats.passed++;
                result.innerHTML = `
                    <div class="success">‚úì XSS DETECTADO E BLOQUEADO!</div>
                    <div class="info">Input original: ${input}</div>
                    <div class="success">Input limpo: ${cleaned}</div>
                `;
            } else {
                stats.passed++;
                result.innerHTML = `<div class="success">‚úì Input seguro - Nenhum XSS detectado</div>`;
            }
            updateStats();
        }

        // Teste 2: Email
        function testEmail() {
            const email = document.getElementById('emailInput').value;
            const result = document.getElementById('emailResult');
            const isValid = SecurityValidator.validateEmail(email);
            
            stats.total++;
            if (isValid) {
                stats.passed++;
                result.innerHTML = `<div class="success">‚úì Email v√°lido!</div>`;
            } else {
                stats.failed++;
                result.innerHTML = `<div class="error">‚úó Email inv√°lido!</div>`;
            }
            updateStats();
        }

        // Teste 3: Password
        function testPassword() {
            const password = document.getElementById('passwordInput').value;
            const result = document.getElementById('passwordResult');
            const isStrong = SecurityValidator.validatePassword(password);
            
            stats.total++;
            if (isStrong) {
                stats.passed++;
                result.innerHTML = `
                    <div class="success">‚úì Senha FORTE!</div>
                    <div class="info">‚úì M√≠nimo 8 caracteres</div>
                    <div class="info">‚úì Cont√©m mai√∫sculas</div>
                    <div class="info">‚úì Cont√©m min√∫sculas</div>
                    <div class="info">‚úì Cont√©m n√∫meros</div>
                    <div class="info">‚úì Cont√©m caracteres especiais</div>
                `;
            } else {
                stats.failed++;
                result.innerHTML = `
                    <div class="error">‚úó Senha FRACA!</div>
                    <div class="warning">Requisitos:</div>
                    <div class="warning">- M√≠nimo 8 caracteres</div>
                    <div class="warning">- Letras mai√∫sculas e min√∫sculas</div>
                    <div class="warning">- N√∫meros</div>
                    <div class="warning">- Caracteres especiais</div>
                `;
            }
            updateStats();
        }

        // Teste 4: Rate Limit
        let attemptCount = 0;
        function testRateLimit() {
            const result = document.getElementById('rateLimitResult');
            attemptCount++;
            
            try {
                RateLimiter.recordAttempt('test');
                stats.total++;
                stats.passed++;
                result.innerHTML = `<div class="info">Tentativa ${attemptCount} registrada com sucesso</div>`;
            } catch (error) {
                stats.total++;
                stats.passed++;
                result.innerHTML = `<div class="success">‚úì BLOQUEADO! ${error.message}</div>`;
            }
            updateStats();
        }

        function resetRateLimit() {
            RateLimiter.resetAttempts();
            attemptCount = 0;
            document.getElementById('rateLimitResult').innerHTML = `<div class="success">‚úì Contador resetado</div>`;
        }

        // Teste 5: Encryption
        async function testEncryption() {
            const input = document.getElementById('encryptInput').value;
            const result = document.getElementById('encryptResult');
            const key = 'test-key-12345';
            
            encryptedData = CryptoModule.encryptData(input, key);
            
            stats.total++;
            stats.passed++;
            result.innerHTML = `
                <div class="success">‚úì Texto criptografado!</div>
                <div class="info">Original: ${input}</div>
                <div class="info">Criptografado: ${encryptedData}</div>
            `;
            updateStats();
        }

        function testDecryption() {
            const result = document.getElementById('encryptResult');
            const key = 'test-key-12345';
            
            if (!encryptedData) {
                result.innerHTML = `<div class="error">‚úó Nenhum dado criptografado! Criptografe primeiro.</div>`;
                return;
            }
            
            const decrypted = CryptoModule.decryptData(encryptedData, key);
            
            stats.total++;
            stats.passed++;
            result.innerHTML = `
                <div class="success">‚úì Texto descriptografado!</div>
                <div class="info">Criptografado: ${encryptedData}</div>
                <div class="success">Descriptografado: ${decrypted}</div>
            `;
            updateStats();
        }

        // Teste 6: Logs
        function viewLogs() {
            const result = document.getElementById('logsResult');
            const logs = JSON.parse(localStorage.getItem('exebots_security_logs') || '[]');
            
            if (logs.length === 0) {
                result.innerHTML = `<div class="warning">Nenhum log encontrado</div>`;
            } else {
                let html = `<div class="success">‚úì ${logs.length} eventos registrados:</div>`;
                logs.slice(-10).reverse().forEach(log => {
                    html += `<div class="info">‚Ä¢ [${log.type}] ${new Date(log.timestamp).toLocaleString()}</div>`;
                });
                result.innerHTML = html;
            }
        }

        function clearLogs() {
            localStorage.removeItem('exebots_security_logs');
            document.getElementById('logsResult').innerHTML = `<div class="success">‚úì Logs limpos</div>`;
        }

        // Teste 7: Session
        function checkSession() {
            const result = document.getElementById('sessionResult');
            const isValid = SessionManager.isSessionValid();
            
            stats.total++;
            if (isValid) {
                stats.passed++;
                result.innerHTML = `<div class="success">‚úì Sess√£o v√°lida e ativa</div>`;
            } else {
                stats.failed++;
                result.innerHTML = `<div class="error">‚úó Sess√£o inv√°lida ou expirada</div>`;
            }
            updateStats();
        }

        function createSession() {
            SessionManager.initSession();
            const token = SessionManager.createSecureSession({ email: 'teste@exemplo.com' });
            document.getElementById('sessionResult').innerHTML = `
                <div class="success">‚úì Sess√£o criada!</div>
                <div class="info">Token: ${token.substring(0, 20)}...</div>
            `;
        }

        function destroySession() {
            SessionManager.destroySession();
            document.getElementById('sessionResult').innerHTML = `<div class="success">‚úì Sess√£o destru√≠da</div>`;
        }

        // Executar todos os testes
        function runAllTests() {
            const result = document.getElementById('allTestsResult');
            result.innerHTML = `<div class="info">üöÄ Executando todos os testes...</div>`;
            
            setTimeout(() => {
                let html = '<div class="success">‚úì TODOS OS TESTES CONCLU√çDOS!</div><br>';
                html += '<div class="info">M√ìDULOS TESTADOS:</div>';
                html += '<div class="success">‚úì XSS Protection</div>';
                html += '<div class="success">‚úì Email Validation</div>';
                html += '<div class="success">‚úì Password Strength</div>';
                html += '<div class="success">‚úì Rate Limiting</div>';
                html += '<div class="success">‚úì Encryption/Decryption</div>';
                html += '<div class="success">‚úì Security Logs</div>';
                html += '<div class="success">‚úì Session Management</div>';
                html += '<br><div class="info">SISTEMA 100% FUNCIONAL! üéâ</div>';
                
                result.innerHTML = html;
            }, 1000);
        }

        // Inicializar
        initSecurity();
        console.log('%cüîí SISTEMA DE TESTES CARREGADO', 'color: #00ff88; font-size: 16px; font-weight: bold;');
    </script>
</body>
</html>
